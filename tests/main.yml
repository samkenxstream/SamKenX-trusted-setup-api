config:
  target: "http://{{$processEnvironment.DOMAIN}}:{{$processEnvironment.PORT}}"
  phases:
    - duration: 1
      arrivalRate: 1
      name: 'Warm up'
  payload:
    name: participants
    cast: false
    loadAll: true
    skipHeader: true
    path: "./participants.csv"
    fields:
      - "address"
      - "signature"
      - "privateKey"

scenarios:
  - name: "Login participants"
    flow:
      - loop:
        - post:
            url: "/participant/login/address"
            json:
              address:    "{{ $loopElement.address }}"
              signature:  "{{ $loopElement.signature }}"
            capture:
              - json: "$.token"
                as:   "token"
        - think: 1 # wait 5 seconds
        - get:
            url: "/queue/checkin"
            headers:
              authorization: "Bearer {{ token }}"

        over: participants